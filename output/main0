#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <ctype.h>

int main() {
    char buscaNOC[10]; // armazena o país digitado pelo usuário
    printf("Digite o NOC (ex: BRA, USA): "); // pergunta o NOC do país 
    scanf("%s", buscaNOC); // usuário digita o NOC do país

    for(int i = 0; buscaNOC[i]; i++) buscaNOC[i] = toupper(buscaNOC[i]); // converte o texto digitado para maiúsculas 

    FILE *arquivo = fopen("results.csv", "r"); // abre o aqrquivo no modo leitura 
    if (!arquivo) {
        printf("Erro: Arquivo results.csv nao encontrado!\n");
        return 1;
    }

    char linha[2048];
    int primeiraMedalha = 0; // contador para a primeira medalha
    int menorAno = 9999; // variável para armazenar o menor ano encontrado
    int ano = 0; // armazena o ano
    char tipoMedalha[10] = ""; // armazena o tipo da medalha

    // pula o cabeçalho do arquivo
    fgets(linha, sizeof(linha), arquivo);

    while (fgets(linha, sizeof(linha), arquivo)) { // percorre o arquivo linha por linha 
        
        char *token = strtok(linha, ","); // tokeniza a linha usando vírgula como delimitador
        int coluna = 0;
        char noc[6] = ""; // armazena o NOC
        char medalha[10] = ""; //armazena a medalha

        while (token != NULL) { // percorre os tokens da linha
            
            if (coluna == 0) { // primeira coluna é o ano
                ano = atoi(token);
            }

            if (coluna == 7) { // coluna do NOC
                strcpy(noc, token);
            }

            if (coluna == 10) { // coluna da medalha
                strcpy(medalha, token);
            }

            token = strtok(NULL, ","); // obtém o próximo token
            coluna++;
        }

        if (strcmp(noc, buscaNOC) == 0 && (strcmp(medalha, "Gold") == 0 || strcmp(medalha, "Silver") == 0 || strcmp(medalha, "Bronze") == 0)) {
            if (ano < menorAno) { // verifica se o ano é menor que o menor ano encontrado
                menorAno = ano; // atualiza o menor ano
                strcpy(tipoMedalha, medalha);
                primeiraMedalha = 1; // marca que a primeira medalha foi encontrada
            } 
        }

    } 

    if (primeiraMedalha == 1) {
        printf("\nA primeira medalha de %s foi conquistada em %d e foi do tipo %s\n", buscaNOC, menorAno, tipoMedalha);
    }

    if (primeiraMedalha == 0) {
        printf("\nNenhuma medalha encontrada para %s.\n", buscaNOC);
    }

    fclose(arquivo);
    return 0;
}